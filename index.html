<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Noite em Coimbra</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  </head>
  <body>
    <h2 style="text-align: center;">Noite em Coimbra</h2>

    <div style="margin-top: 100px;" class="container">
      <div>
        <input type="text" name="nome" value="" placeholder="Nome" id="new-bar-name">
        <input type="submit" name="votos" value="Adicionar" id="add-bar">
      </div>

      <div style="margin-top: 30px;">
        <span>Order by: </span>
        <button id='order-button'>Votes</button>
      </div>

      <table class="table" style="margin-top: 30px;">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Votos</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Bigorna</td>
            <td>10</td>
          </tr>
          <tr>
            <td>Twit</td>
            <td>14</td>
          </tr>
          <tr>
            <td>Cabido</td>
            <td>5</td>
          </tr>
          <tr>
            <td>NB</td>
            <td>23</td>
          </tr>
        </tbody>
      </table>
    </div>

    <script type="text/javascript" charset="utf-8">
      function addNewBar(nome, votes) {
        var tbody = document.querySelectorAll('table tbody')[0];

        // Criar <td> para o nome
        var nomeTd = document.createElement('TD');
        var nomeText = document.createTextNode(nome);
        nomeTd.appendChild(nomeText);

        // Criar <td> para os votos
        var votosTd = document.createElement('TD');
        var votosText = document.createTextNode(votes || 0);
        votosTd.appendChild(votosText);

        // Criar <tr> para o novo bar
        var newTr = document.createElement('TR');
        newTr.appendChild(nomeTd);
        newTr.appendChild(votosTd);

        // Introduzir o novo <tr> na tabela
        tbody.appendChild(newTr);
      }

      // Obter o bot√£o de Adicionar e <input> com o nome do novo Bar
      var addButton = document.getElementById('add-bar');
      var newBarName = document.getElementById('new-bar-name');

      // Escutar o evento de 'click' e introduzir o novo bar na tabela
      addButton.addEventListener('click', function(event) {
        var newName = newBarName.value;

        newBarName.value = '';
        addNewBar(newName);
      });
    </script>

    <script type="text/javascript" charset="utf-8">
      function orderByVotes() {
        var bares = document.querySelectorAll('tbody tr');

        // Transformar bares (atualmente um NodeList) num Array
        var baresArray = [];
        for (var i = 0; i < bares.length; i++) {
          baresArray.push(bares[i]);
        }

        // Ordenar a lista de bares pelo numero de votos
        var ordered = baresArray.sort(function(barPrevious, barNext) {
          var votesPrevious = barPrevious.querySelectorAll('td')[1].innerText;
          var votesNext = barNext.querySelectorAll('td')[1].innerText;

          return votesNext - votesPrevious;
        });

        // Substituir a lista atual pela lista ordenada
        var tbody = document.querySelectorAll('tbody')[0];
        tbody.innerHTML = '';

        ordered.forEach(function(bar) {
          var name = bar.querySelectorAll('td')[0].innerText;
          var votes = bar.querySelectorAll('td')[1].innerText;

          addNewBar(name, votes);
        });
      }

      // Escutar o evento de 'click' e ordenar bares por votos
      var orderButton = document.getElementById('order-button');
      orderButton.addEventListener('click', orderByVotes);
    </script>
  </body>
</html>
