<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Noite em Coimbra</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.js" type="text/javascript"></script>
  </head>
  <body>
    <h2 style="text-align: center;">Noite em Coimbra</h2>

    <div style="margin-top: 100px;" class="container">
      <div>
        <input type="text" name="nome" value="" placeholder="Nome" id="new-bar-name">
        <input type="submit" name="votos" value="Adicionar" id="add-bar">
      </div>

      <div style="margin-top: 30px;">
        <span>Order by: </span>
        <button id='order-name-button'>Name</button>
        <button id='order-button'>Votes</button>
      </div>

      <table class="table" style="margin-top: 30px;">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Votos</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>


    <script id="bar-template" type="text/x-handlebars-template">
      <tr>
        <td>{{ nome }}</td>
        <td>{{ votes }}</td>
      </tr>
    </script>


    <!-- Dados iniciais -->
    <script type="text/javascript" charset="utf-8">
      var data = {
        bares: [
          {
            name: 'Moelas',
            votes: 5
          },
          {
            name: 'NB',
            votes: 27
          },
          {
            name: 'Bigorna',
            votes: 31
          },
          {
            name: 'Cabido',
            votes: 43
          }
        ]
      }

      function addBar(nome, votes) {
        data.bares.push({
          name: nome,
          votes: votes || 0
        });

        renderBares();
      }

      function renderBar(nome, votes) {
        // Compilar o template
        var barTemplateHTML = document.getElementById('bar-template').innerHTML;
        var barTemplate = Handlebars.compile(barTemplateHTML);

        // Popular o template com os dados
        var bar = barTemplate({ nome: nome, votes: votes });

        return bar;
      }

      function renderBares() {
        var tbody = document.querySelectorAll('table tbody')[0];

        tbody.innerHTML = '';
        data.bares.forEach(function(bar) {
          var newBarElement = renderBar(bar.name, bar.votes);
          tbody.innerHTML += newBarElement;
        });
      }

      renderBares();
    </script>


    <!-- Adicionar novo bar -->
    <script type="text/javascript" charset="utf-8">
      // Obter o bot√£o de Adicionar e <input> com o nome do novo Bar
      var addButton = document.getElementById('add-bar');
      var newBarName = document.getElementById('new-bar-name');

      // Escutar o evento de 'click' e introduzir o novo bar na tabela
      addButton.addEventListener('click', function(event) {
        var newName = newBarName.value;

        newBarName.value = '';
        addBar(newName);
      });
    </script>


    <!-- Ordenar bares por votos -->
    <script type="text/javascript" charset="utf-8">
      function orderByVotes() {
        // Ordenar a lista de bares pelo numero de votos
        var ordered = data.bares.sort(function(barPrevious, barNext) {
          return barNext.votes - barPrevious.votes;
        });

        data.bares = ordered;
        renderBares();
      }

      // Escutar o evento de 'click' e ordenar bares por votos
      var orderButton = document.getElementById('order-button');
      orderButton.addEventListener('click', orderByVotes);
    </script>


    <!-- Ordernar bares por nome -->
    <script type="text/javascript" charset="utf-8">
      function orderByName() {
        // Ordenar a lista de bares pelo numero de votos
        var ordered = data.bares.sort(function(barPrevious, barNext) {
          return barPrevious.name.localeCompare(barNext.name);
        });

        data.bares = ordered;
        renderBares();
      }

      // Escutar o evento de 'click' e ordenar bares por votos
      var orderNameButton = document.getElementById('order-name-button');
      orderNameButton.addEventListener('click', orderByName);
    </script>
  </body>
</html>
